/******************************** 套系详情 ***************************************/
<template>
   <view class="boxDitel">
        <!-- 轮播 -->
        <banner :imgs="listDetai.topCarouseList"/>

        <!-- 内容文字 -->
        <view class="content marginB30 padding10 marginRL10">
            <view class="flex content_top">
                <text>{{listDetai.name}}</text>
                <text class="colorRed">￥{{listDetai.assemblyPrice?listDetai.assemblyPrice:''}}</text>
            </view>
            <view class="content_text flex">
                <view class="content_text_l">
                    服务内容
                </view>
                <view class="context_li  flex">
                    <view class="flex paddingRL20 paddingT10" v-for="(item,index) in serverList" :key="index" >
                       <i-icon class="icon " type="success" size="20" color="#FF4852"  />
                       <text>{{item.name}}</text><text>{{item.count? 'X '+ item.count:''}}</text>
                    </view>
                </view>
            </view>
            
        </view>

        <!-- 图片展示 -->
        <view class="imgShow marginT10 marginRL10">
            <!-- tab切换 -->
            <view class="imgTab flex fontSize24 textC marginB30">
                <view class="imgTab_li" :class="Index==index?'active':''" v-for="(item,index) in Tab" :key="index" @click="onClickTab(index)">{{item}}</view>
            </view>

            <!-- 展示 -->
            <view v-if="Index == 0?true:false" class="showTab padding10">
                <image mode='widthFix' class="img marginB10 " v-for="(item,index) in listDetai.detailPhotoList" :key="index"  :src="item"></image>
            </view>

            <view v-else>
                <view class="paddingRL40" v-html="testData"></view>
            </view>
        </view>

        <!-- 购物车定位 -->
        <buyCar type="details" @goCar="goCar" @addCar="addCar" @onQuick="onQuick"/>

         <!-- 弹窗 -->
        <i-message id="message" />
   </view>
</template>

<script>
import banner from '@/components/banner.vue'
import buyCar from '@/components/buyCar.vue'
import { getAssemblyOnlineDetail } from '@/util/api/goods.js'
import { getAssemblyDescription } from '@/util/api/user.js'
 import { mapMutations, mapGetters } from 'vuex'
    export default {
        computed:{
			...mapGetters('user',[
                'get_appId',
                'get_enterpriseId',
                'get_shopId'
			]),
        },
        components:{
            banner,
            buyCar
        },
        
        data(){
            return{
                Tab:['产品展示','服务说明'],
                listDetai:[], // 详情数据
                testData:'', // 套系服务说明
                serverList:null, // 服务内容
                Index:0, // tab 索引
                Id:0,
               }
        },
        onLoad(options) {
            this.Id = options.id;
            this.getAssemblyOnlineDetail()

            this.getAssemblyDescription()
        },
        methods:{
            ...mapMutations('carList',[
                'mut_carListAdd',
                'mut_quickListAdd'
            ]),

            // 获取线上套系详情
            getAssemblyOnlineDetail(){
                let param = {
                    enterpriseId:this.get_enterpriseId,
                    id:this.Id
                }
                getAssemblyOnlineDetail(param).then(res=>{
                    this.listDetai = res.data.data
                    // 组装服务内容
                    let json = {}
                    this.listDetai.assemblyItemList.map(item=>{
                        // 服装
                        item.assemblyItemDressInfos.map(val=>{
                            if(!json.assemblyItemDressInfos){
                                json.assemblyItemDressInfos = []
                            }
                            json.assemblyItemDressInfos.push({
                                name:val.name,
                                count:val.count,
                            })
                        })
                        // 商品
                        item.assemblyItemGoods.map(val=>{
                            if(!json.assemblyItemGoods){
                                json.assemblyItemGoods = []
                            }
                            json.assemblyItemGoods.push({
                                name:val.name,
                                count:val.count,
                            })
                        })
                        // 景点
                        item.assemblyItemPlaces.map(val=>{
                            if(!json.assemblyItemPlaces){
                                json.assemblyItemPlaces = []
                            }
                            json.assemblyItemPlaces.push({
                                name:val.name,
                                count:val.count,
                            })
                        })
                        // 服务
                        item.assemblyItemServices.map(val=>{
                            if(!json.assemblyItemServices){
                                json.assemblyItemServices = []
                            }
                            json.assemblyItemServices.push({
                                name:val.name,
                                count:val.count,
                            })
                        })
                    })
                    
                    let arr = []
                    for (const key in json) {
                        json[key].map(item=>{
                            arr.push(item)
                        })
                    }
                    this.serverList = arr
                })
            },

            // 套系服务说明 
            getAssemblyDescription(){
                let param = {
					appId:this.get_appId,
					enterpriseId:this.get_enterpriseId
				}
                getAssemblyDescription(param).then(res=>{
                    this.testData = res.data.data
                })
            },

            // 切换tab
            onClickTab(idx){
                this.Index = idx
            },

            // 进入购物车
            goCar(){
                uni.switchTab({
                    url:'/pages/tabBar/shoppingCart/shoppingCart'
                })
            },

            // 添加到购物车
            addCar(flag){
                let datas={
                        id:this.listDetai.id,
                        name:this.listDetai.name,
                        price:this.listDetai.assemblyPrice,
                        imgs:this.listDetai.detailPhotoList?this.listDetai.detailPhotoList[0]:'',
                        times:'',
                        filesTime:'',
                        filesPrice:'',
                        orderType:this.listDetai.orderType,
                        shopId: this.get_shopId.shopId,
                        shopName: this.get_shopId.shopName,
                        shopNo: this.get_shopId.shopNo
                    }
                // 判断是否立刻下单
                if(flag){
                    this.mut_quickListAdd([datas])
                }else{
                    this.mut_carListAdd(datas)
                }
            },

            // 立刻预约
            onQuick(){
                this.addCar('quick')
                uni.navigateTo({ 
                    url: '/pages/tabBar/shoppingCart/components/buyOrder'
                })
            }

        }
    }
</script>

<style lang="scss" scoped>
.boxDitel{
    background: #F9F9F9;
}
.content{
    background: rgba(255,255,255,0.8);
    border-radius: 20rpx;
    font-size: 30rpx;
    box-sizing: content-box;
    .content_top{
        padding: 40rpx 25rpx;
        justify-content: space-between;
        border-bottom: 1px solid #DDDDDD;
        font-weight: bold;
    }
    .content_text{
        justify-content: space-around;
        align-items: center;
        font-size: 24rpx;
        color:#999999;
        .content_text_l{
            width: 80rpx;
            line-height: 40rpx;
            font-size: 30rpx;
            margin-left: 40rpx;
        }
    }
    .context_li{
        flex-wrap: wrap;
        width: 550rpx;
        .paddingRL20{
                padding-left: 100rpx;
            }
        .flex{
            width: 550rpx;
            height: 80rpx;
            align-items: center;
            
            .icon{
                padding-right: 20rpx;
            }
        }
    }
}
.imgShow{
    background: #fff;
    border-radius: 20rpx;
    .imgTab{
        padding-top: 30rpx;
        .imgTab_li{
            width: 50%;
        }
        .active{
            color: #FF4852;
            font-weight: bold;
        }
    }
    .showTab{
        box-sizing: content-box;
        .marginB10{
            margin-bottom: -8rpx;
        }
    }
}
</style>